{% extends 'base.html' %}
{% block title %}{{ category.name }} – MRI Planning Guide{% endblock %}
{% block content %}

<!-- HEADER STRIP -->
<div class="bg-cuf-navy text-white py-8 px-6">
  <div class="max-w-6xl mx-auto">
    <nav class="flex items-center gap-2 text-xs text-cuf-muted mb-4">
      <a href="{{ url_for('index') }}" class="hover:text-white transition">Início</a>
      <span>›</span>
      <span class="text-white">{{ category.name }}</span>
    </nav>
    <div class="flex items-center gap-4">
      <div class="w-14 h-14 rounded-xl flex items-center justify-center font-display font-700 text-xl text-white shadow-lg"
           style="background:{{ category.color }};">RM</div>
      <div>
        <h1 class="font-display font-700 text-3xl tracking-wide">{{ category.name }}</h1>
        <p class="text-cuf-border text-sm mt-1">{{ exams_data|length }} protocolo{% if exams_data|length!=1 %}s{% endif %} disponíve{% if exams_data|length!=1 %}is{% else %}l{% endif %}</p>
      </div>
    </div>
  </div>
</div>

<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

  {% if exams_data %}
  <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
    {% for item in exams_data %}{% set exam=item.exam %}{% set seqs=item.sequences %}{% set imgs=item.images %}
    <a href="{{ url_for('exam_detail', exam_id=exam.id) }}"
       class="card p-6 group hover:-translate-y-0.5 transition-all duration-200 no-underline flex flex-col gap-3">

      <!-- Top accent line -->
      <div class="h-1 rounded-full -mt-6 -mx-6 mb-3" style="background:{{ category.color }};"></div>

      <!-- Header -->
      <div class="flex items-start justify-between gap-3">
        <h2 class="font-display font-700 text-cuf-navy text-xl leading-tight group-hover:text-cuf-blue transition">{{ exam.name }}</h2>
        <span class="badge {% if 'sem' in exam.contrast|lower and 'com' not in exam.contrast|lower %}badge-green{% else %}badge-amber{% endif %} shrink-0 text-xs">
          {% if 'sem' in exam.contrast|lower and 'com' not in exam.contrast|lower %}Sem contraste{% else %}{{ exam.contrast }}{% endif %}
        </span>
      </div>

      {% if exam.description %}
      <p class="text-sm text-cuf-muted leading-relaxed line-clamp-2">{{ exam.description }}</p>
      {% endif %}

      <!-- Planes -->
      {% if exam.planes %}
      <div class="flex flex-wrap gap-1.5">
        {% for plane in exam.planes.split(',') %}
        <span class="badge badge-blue text-xs">{{ plane.strip() }}</span>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Footer info -->
      <div class="flex items-center justify-between pt-2 border-t border-cuf-border mt-auto">
        <div class="flex items-center gap-4 text-xs text-cuf-muted">
          {% if seqs %}
          <span class="flex items-center gap-1">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h8"/></svg>
            {{ seqs|length }} seq.
          </span>
          {% endif %}
          {% if imgs %}
          <span class="flex items-center gap-1">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" stroke-width="2"/><circle cx="8.5" cy="8.5" r="1.5" stroke-width="0"/><path stroke-linecap="round" stroke-width="2" d="M21 15l-5-5L5 21"/></svg>
            {{ imgs|length }} img.
          </span>
          {% endif %}
        </div>
        <span class="text-cuf-blue text-xs font-semibold group-hover:translate-x-0.5 transition-transform inline-flex items-center gap-1">
          Ver protocolo
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
        </span>
      </div>
    </a>
    {% endfor %}
  </div>

  {% else %}
  <div class="card p-12 text-center">
    <h3 class="font-display font-700 text-cuf-navy text-xl mb-2">Sem protocolos</h3>
    <p class="text-cuf-muted mb-6">Esta categoria ainda não possui exames cadastrados.</p>
    {% if session.get('admin_logged_in') %}
    <a href="{{ url_for('admin_new_exam') }}" class="btn-primary inline-block">+ Adicionar Exame</a>
    {% endif %}
  </div>
  {% endif %}

  <div class="mt-8">
    <a href="{{ url_for('index') }}" class="btn-secondary inline-flex items-center gap-2">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
      Voltar ao Início
    </a>
  </div>
</div>
{% endblock %}
